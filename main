#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef struct Data {
    int dia; 
    int mes; 
    int ano; 
} Data;

typedef struct Registro {
    char nome[100]; 
    int idade; 
    char rg[20]; 
    Data* entrada; 
} Registro;

typedef struct ELista {
    Registro* dados; 
    struct ELista* proximo; 
} ELista;

typedef struct Lista {
    ELista* inicio; 
    int qtd; 
} Lista;

typedef struct EFila {
    Registro* dados; 
    struct EFila* proximo; 
} EFila;

typedef struct Fila {
    EFila* head; 
    EFila* tail; 
    int qtd; 
} Fila;

typedef struct EABB {
    Registro* dados; 
    struct EABB* filhoEsq; 
    struct EABB* filhoDir; 
} EABB;

typedef struct ABB {
    EABB* raiz; 
    int qtd; 
} ABB;

typedef struct Operacao {
    int tipo;
    Registro* paciente;
    struct Operacao* proximo;
} Operacao;

typedef struct PilhaOperacao {
    Operacao* topo;
} PilhaOperacao;

void iniciopilha(PilhaOperacao* pilha) {
    pilha->topo = NULL;
}

void inicio_lista(Lista* lista) {
    lista->inicio = NULL;
    lista->qtd = 0;
}

void inicio_fila(Fila* fila) {
    fila->head = NULL;
    fila->tail = NULL;
    fila->qtd = 0;
}

void inicioABB(ABB* arvore) {
    arvore->raiz = NULL;
    arvore->qtd = 0;
}

void empilharOperacao(PilhaOperacao* pilha, int tipo, Registro* paciente) {
    Operacao* nova_operacao = (Operacao*)malloc(sizeof(Operacao));
    if (nova_operacao == NULL) {
        printf("Erro");
        return;
    }
    nova_operacao->tipo = tipo;
    nova_operacao->paciente = paciente;
    nova_operacao->proximo = pilha->topo;
    pilha->topo = nova_operacao;
}

Operacao* desempilhar_operacao(PilhaOperacao* pilha) {
    if (pilha->topo == NULL) {
        printf("Nenhuma operacao para desfazer.");
        return NULL;
    }
    Operacao* operacao = pilha->topo;
    pilha->topo = pilha->topo->proximo;
    return operacao;
}

void limpar_buffer() {
    int c;
    while ((c = getchar()) != '\n' && c != EOF);
}

int rg_existente(Lista* lista, const char* rg) {
    ELista* atual = lista->inicio;
    while (atual != NULL) {
        if (strcmp(atual->dados->rg, rg) == 0) {
            return 1;
        }
        atual = atual->proximo;
    }
    return 0;
}

EABB* inserir(EABB* raiz, Registro* dados) {
    if (raiz == NULL) {
        EABB* novoNo = (EABB*)malloc(sizeof(EABB));
        if (novoNo == NULL) {
            printf("Erro\n");
            return NULL;
        }
        novoNo->dados = dados;
        novoNo->filhoEsq = NULL;
        novoNo->filhoDir = NULL;
        return novoNo;
    }
    if (dados->entrada->ano < raiz->dados->entrada->ano) {
        raiz->filhoEsq = inserir(raiz->filhoEsq, dados);
    } else if (dados->entrada->ano > raiz->dados->entrada->ano) {
        raiz->filhoDir = inserir(raiz->filhoDir, dados);
    }
    return raiz;
}

void inserir_pacienteABB(ABB* arvore, Registro* dados) {
    arvore->raiz = inserir(arvore->raiz, dados);
    arvore->qtd++;
}
